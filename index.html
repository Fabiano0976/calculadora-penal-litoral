<script>
// ============================
// TABELA DE ARTIGOS – LITORAL CITY
// ============================
// codigo: { descricao, servicos, multa, fianca, semFianca? }

const artigos = {
  "10":   { descricao: "Homicídio doloso (matar alguém com intenção)", servicos: 60, multa: 60000, fianca: 0, semFianca: true },
  "10.1": { descricao: "Homicídio culposo (sem intenção)",             servicos: 40, multa: 40000, fianca: 0, semFianca: true },
  "10.2": { descricao: "Homicídio a oficial",                           servicos: 60, multa: 50000, fianca: 0, semFianca: true },
  "10.3": { descricao: "Latrocínio (roubo seguido de morte)",           servicos: 50, multa: 40000, fianca: 0, semFianca: true },
  "11":   { descricao: "Tentativa de homicídio",                        servicos: 40, multa: 35000, fianca: 0, semFianca: true },
  "11.1": { descricao: "Tentativa de homicídio a oficial",             servicos: 50, multa: 40000, fianca: 0, semFianca: true },
  "11.2": { descricao: "Múltiplos homicídios",                          servicos: 60, multa: 60000, fianca: 0, semFianca: true },
  "12":   { descricao: "Sequestro e cárcere privado",                   servicos: 40, multa: 30000, fianca: 0, semFianca: true },
  "12.1": { descricao: "Sequestro a oficial",                           servicos: 60, multa: 35000, fianca: 0, semFianca: true },
  "12.2": { descricao: "Extorsão mediante sequestro",                   servicos: 50, multa: 40000, fianca: 0, semFianca: true },

  "14.1": { descricao: "Difamação",                                     servicos: 15, multa: 6000,  fianca: 14000 },
  "14.2": { descricao: "Calúnia",                                       servicos: 15, multa: 6000,  fianca: 14000 },
  "14.3": { descricao: "Injúria",                                       servicos: 25, multa: 14000, fianca: 20000 },
  "15":   { descricao: "Ameaça",                                        servicos: 20, multa: 8000,  fianca: 16000 },
  "15.1": { descricao: "Ameaça contra oficial",                         servicos: 30, multa: 10000, fianca: 20000 },
  "15.2": { descricao: "Ameaça com violência",                          servicos: 30, multa: 10000, fianca: 20000 },

  "17":   { descricao: "Crueldade animal",                              servicos: 20, multa: 12000, fianca: 24000 },
  "18":   { descricao: "Lesão corporal",                                servicos: 20, multa: 6000,  fianca: 14000 },
  "19":   { descricao: "Omissão de socorro",                            servicos: 15, multa: 7000,  fianca: 18000 },
  "20":   { descricao: "Danos morais",                                  servicos: 15, multa: 5000,  fianca: 10000 },
  "20.1": { descricao: "Assédio moral",                                 servicos: 60, multa: 50000, fianca: 100000 },
  "21":   { descricao: "Ato obsceno",                                   servicos: 20, multa: 6000,  fianca: 14000 },
  "21.1": { descricao: "Atentado ao pudor",                             servicos: 60, multa: 120000,fianca: 0, semFianca: true },

  "23":   { descricao: "Roubo",                                         servicos: 30, multa: 8000,  fianca: 20000 },
  "23.1": { descricao: "Tentativa de roubo",                            servicos: 20, multa: 6000,  fianca: 14000 },
  "23.2": { descricao: "Furto",                                         servicos: 10, multa: 5000,  fianca: 12000 },
  "24":   { descricao: "Assalto à loja",                                servicos: 40, multa: 15000, fianca: 32000 },
  "25":   { descricao: "Assalto a banco",                               servicos: 45, multa: 20000, fianca: 44000 },
  "26":   { descricao: "Assalto à joalheria",                           servicos: 50, multa: 25000, fianca: 48000 },
  "27":   { descricao: "Assalto ao Banco Central",                      servicos:100, multa: 50000, fianca:120000 },
  "28":   { descricao: "Roubo a registradora",                          servicos: 25, multa: 12000, fianca: 28000 },
  "29":   { descricao: "Roubo a caixa eletrônico",                      servicos: 30, multa: 16000, fianca: 32000 },
  "30":   { descricao: "Assalto a loja de armas",                       servicos: 40, multa: 18000, fianca: 38000 },
  "31":   { descricao: "Lavagem / ocultação de bens",                   servicos: 60, multa: 34000, fianca: 76000 },
  "32":   { descricao: "Dano ao patrimônio",                            servicos: 40, multa: 15000, fianca: 32000 },
  "32.1": { descricao: "Invasão à propriedade",                         servicos: 20, multa: 8000,  fianca: 18000 },
  "33":   { descricao: "Receptação",                                    servicos: 30, multa: 16000, fianca: 32000 },
  "34":   { descricao: "Estelionato",                                   servicos: 40, multa: 12000, fianca: 38000 },
  "34.1": { descricao: "Extorsão",                                      servicos: 30, multa: 16000, fianca: 36000 },
  "34.2": { descricao: "Evasão financeira",                             servicos: 30, multa: 15000, fianca: 34000 },

  "36":   { descricao: "Posse de substâncias ilícitas",                 servicos: 30, multa: 18000, fianca: 40000 },
  "36.1": { descricao: "Posse ilegal de armas (baixo calibre)",         servicos: 40, multa: 20000, fianca: 48000 },
  "36.2": { descricao: "Posse de itens de uso governamental",           servicos: 40, multa: 24000, fianca: 52000 },
  "36.3": { descricao: "Posse de dinheiro sujo abaixo de 100.000",      servicos: 20, multa: 40000, fianca: 82000 },
  "36.4": { descricao: "Posse de dinheiro sujo acima de 100.000",       servicos: 40, multa: 80000, fianca:180000 },
  "37":   { descricao: "Tráfico de órgãos",                             servicos: 40, multa: 70000, fianca:140000 },
  "38":   { descricao: "Tráfico de armas e munições",                   servicos: 50, multa: 70000, fianca:160000 },
  "38.1": { descricao: "Posse de equipamento balístico",                servicos: 40, multa: 26000, fianca: 56000 },
  "39":   { descricao: "Tráfico de armas médio/alto calibre",           servicos: 60, multa: 90000, fianca:180000 },
  "40":   { descricao: "Dinheiro sujo abaixo de 40.000",                servicos: 30, multa: 20000, fianca: 62000 },

  "41":   { descricao: "Corrupção passiva",                             servicos: 40, multa: 30000, fianca: 80000 },
  "41.1": { descricao: "Corrupção de autoridade",                       servicos: 50, multa:100000, fianca:220000 },
  "42":   { descricao: "Corrupção ativa",                               servicos: 60, multa: 60000, fianca:140000 },
  "42.1": { descricao: "Tentativa de suborno",                          servicos: 30, multa: 30000, fianca: 84000 },
  "43":   { descricao: "Obstrução de justiça",                          servicos: 40, multa: 60000, fianca:128000 },
  "43.1": { descricao: "Omissão/obstrução de provas",                   servicos: 30, multa: 30000, fianca: 64000 },
  "44":   { descricao: "Prevaricação",                                  servicos: 60, multa: 80000, fianca:160000 },
  "44.1": { descricao: "Abuso de autoridade",                           servicos: 20, multa: 24000, fianca: 56000 },
  "45":   { descricao: "Usurpação de função pública",                   servicos: 60, multa: 60000, fianca:120000 },
  "46":   { descricao: "Abolição violenta do Estado Democrático",       servicos: 60, multa: 50000, fianca:120000 },
  "47":   { descricao: "Associação criminosa",                          servicos: 40, multa: 18000, fianca: 40000 },
  "48":   { descricao: "Falsidade ideológica",                          servicos: 20, multa: 6000,  fianca: 18000 },
  "49":   { descricao: "Impossibilidade de identificação",              servicos: 10, multa: 6000,  fianca: 12000 },
  "50":   { descricao: "Falso testemunho (perjúrio)",                   servicos: 40, multa: 40000, fianca: 86000 },
  "51":   { descricao: "Lei de propriedade industrial",                 servicos: 60, multa: 80000, fianca:150000 },
  "51.1": { descricao: "Empresa irregular",                             servicos: 70, multa: 50000, fianca:100000 },
  "51.2": { descricao: "Crime contra relações de consumo",              servicos: 30, multa: 54000, fianca:120000 },
  "52":   { descricao: "Venda ilegal de produtos restritos",            servicos: 25, multa: 40000, fianca: 90000 },
  "53":   { descricao: "Favorecimento pessoal",                         servicos: 40, multa: 30000, fianca: 90000 },

  "54":   { descricao: "Desordem social",                               servicos: 15, multa: 5000,  fianca: 12000 },
  "54.1": { descricao: "Apologia ao crime",                             servicos: 30, multa: 50000, fianca:110000 },
  "55":   { descricao: "Desacato",                                      servicos: 20, multa: 12000, fianca: 26000 },
  "56":   { descricao: "Desobediência",                                 servicos: 15, multa: 10000, fianca: 22000 },
  "57":   { descricao: "Resistência à prisão",                          servicos: 20, multa: 5000,  fianca: 15000 },
  "58":   { descricao: "Fuga de pessoa presa",                          servicos: 20, multa: 16000, fianca: 38000 },
  "58.1": { descricao: "Fuga de abordagem policial",                    servicos: 20, multa: 8000,  fianca: 20000 },
  "59":   { descricao: "Ocultação facial",                              servicos: 10, multa: 8000,  fianca: 18000 },
  "60":   { descricao: "Multas pendentes acima de 50.000",              servicos: 30, multa: 8000,  fianca:100000 },
  "61":   { descricao: "Poluição sonora",                               servicos: 10, multa: 6000,  fianca: 12000 },
  "62":   { descricao: "Não respeitar perímetro da ação",               servicos: 10, multa: 20000, fianca: 12000 },
  "63":   { descricao: "Excesso de ficha criminal",                     servicos: 60, multa: 10000, fianca: 15000 },

  "66":   { descricao: "Excesso de velocidade",                         servicos: 0,  multa: 8000,  fianca: 0 },
  "67":   { descricao: "Atropelamento",                                 servicos: 10, multa: 5000,  fianca: 15000 },
  "68":   { descricao: "Direção perigosa",                              servicos: 10, multa: 5000,  fianca: 15000 },
  "68.1": { descricao: "Corrida ilegal",                                servicos: 20, multa: 14000, fianca: 34000 },
  "69":   { descricao: "Veículo em local proibido",                     servicos: 0,  multa: 4000,  fianca: 0 },
  "70":   { descricao: "Veículo abandonado",                            servicos: 0,  multa: 5000,  fianca: 0 },
  "71":   { descricao: "Veículo danificado (sem condições)",            servicos: 0,  multa: 3000,  fianca: 0 },
  "72":   { descricao: "Uso de veículo de terceiros para crimes",       servicos: 30, multa: 30000, fianca: 68000 },
  "73":   { descricao: "Tráfego aéreo sem licença",                     servicos: 50, multa: 30000, fianca: 80000 },
  "73.1": { descricao: "Pouso em local indevido",                       servicos: 10, multa: 40000, fianca: 0, semFianca: true },
  "73.2": { descricao: "Pilotagem perigosa",                            servicos: 10, multa: 50000, fianca: 0, semFianca: true }
};

// ============================
// ESTADO DA CALCULADORA
// ============================

let listaArtigos = [];

// ============================
// FORMATADORES
// ============================

function formatarMoeda(valor) {
  return valor.toLocaleString("pt-BR", {
    style: "currency",
    currency: "BRL",
    minimumFractionDigits: 2
  });
}

// ============================
// DOM ELEMENTS
// ============================

const inputNome = document.getElementById("inputNome");
const inputCPF = document.getElementById("inputCPF");
const inputCodigo = document.getElementById("inputCodigo");
const inputObservacao = document.getElementById("inputObservacao");
const selectArtigo = document.getElementById("selectArtigo");
const tabelaBody = document.getElementById("tabelaArtigosBody");

const totalServicosSpan = document.getElementById("totalServicos");
const totalMultaSpan = document.getElementById("totalMulta");
const totalFiancaSpan = document.getElementById("totalFianca");

const chkReuPrimario = document.getElementById("chkReuPrimario");
const chkAdvogado = document.getElementById("chkAdvogado");
const chkCooperacao = document.getElementById("chkCooperacao");
const chkDelacao = document.getElementById("chkDelacao");
const chkReuConfesso = document.getElementById("chkReuConfesso");

const penaFinalSpan = document.getElementById("penaFinal");
const resultadoMultaSpan = document.getElementById("resultadoMulta");
const resultadoFiancaSpan = document.getElementById("resultadoFianca");
const statusRPSpan = document.getElementById("statusRP");
const statusRPDetalhe = document.getElementById("statusRPDetalhe");

const selectSituacao = document.getElementById("selectSituacao");
const resumoDiscordTextarea = document.getElementById("resumoDiscord");

// Botões
const btnAdicionar = document.getElementById("btnAdicionar");
const btnCalcularFinal = document.getElementById("btnCalcularFinal");
const btnCopiarDiscord = document.getElementById("btnCopiarDiscord");

// ============================
// POPULAR SELECT DE ARTIGOS
// ============================

function popularSelectArtigos() {
  Object.entries(artigos).forEach(([codigo, dados]) => {
    const opt = document.createElement("option");
    opt.value = codigo;

    const txtServ = dados.servicos ? `${dados.servicos}m` : "0m";
    const txtMulta = formatarMoeda(dados.multa);
    const txtFianca = dados.semFianca ? "Sem fiança" : formatarMoeda(dados.fianca);

    opt.textContent = `Art. ${codigo} • ${dados.descricao} • ${txtServ} • Multa: ${txtMulta} • Fiança: ${txtFianca}`;
    selectArtigo.appendChild(opt);
  });
}

// ============================
// LISTA / TABELA DE ARTIGOS
// ============================

function adicionarArtigo(codigo) {
  const dados = artigos[codigo];
  if (!dados) {
    alert("Artigo não encontrado. Verifique o código ou atualize a tabela de artigos.");
    return;
  }

  const observacao = (inputObservacao?.value || "").trim();
  const descricaoFinal = observacao ? `${dados.descricao} (${observacao})` : dados.descricao;

  listaArtigos.push({
    codigo,
    descricao: descricaoFinal,
    servicos: dados.servicos,
    multa: dados.multa,
    fianca: dados.fianca,
    semFianca: !!dados.semFianca
  });

  if (inputCodigo) inputCodigo.value = "";
  if (inputObservacao) inputObservacao.value = "";
  if (selectArtigo) selectArtigo.value = "";

  renderTabela();
  atualizarTotais();
}

function removerArtigo(index) {
  listaArtigos.splice(index, 1);
  renderTabela();
  atualizarTotais();
}

function renderTabela() {
  tabelaBody.innerHTML = "";

  listaArtigos.forEach((item, index) => {
    const tr = document.createElement("tr");

    const tdCod = document.createElement("td");
    tdCod.textContent = item.codigo;
    tr.appendChild(tdCod);

    const tdDesc = document.createElement("td");
    tdDesc.textContent = item.descricao;
    tr.appendChild(tdDesc);

    const tdServ = document.createElement("td");
    tdServ.textContent = item.servicos;
    tr.appendChild(tdServ);

    const tdMulta = document.createElement("td");
    tdMulta.textContent = formatarMoeda(item.multa);
    tr.appendChild(tdMulta);

    const tdFianca = document.createElement("td");
    tdFianca.textContent = item.semFianca ? "Sem fiança" : formatarMoeda(item.fianca);
    tr.appendChild(tdFianca);

    const tdAcoes = document.createElement("td");
    const btn = document.createElement("button");
    btn.textContent = "X";
    btn.className = "btn-remove small";
    btn.onclick = () => removerArtigo(index);
    tdAcoes.appendChild(btn);
    tr.appendChild(tdAcoes);

    tabelaBody.appendChild(tr);
  });
}

function atualizarTotais() {
  const totalServicos = listaArtigos.reduce((s, a) => s + a.servicos, 0);
  const totalMulta = listaArtigos.reduce((s, a) => s + a.multa, 0);
  const totalFianca = listaArtigos.reduce((s, a) => s + (a.semFianca ? 0 : a.fianca), 0);

  totalServicosSpan.textContent = totalServicos;
  totalMultaSpan.textContent = formatarMoeda(totalMulta);
  totalFiancaSpan.textContent = formatarMoeda(totalFianca);
}

// ============================
// CÁLCULO DA PENA
// ============================

function calcularPenaFinal() {
  if (listaArtigos.length === 0) {
    alert("Adicione pelo menos um artigo antes de calcular.");
    return;
  }

  const totalServicos = listaArtigos.reduce((s, a) => s + a.servicos, 0);
  const totalMulta = listaArtigos.reduce((s, a) => s + a.multa, 0);
  const totalFianca = listaArtigos.reduce((s, a) => s + (a.semFianca ? 0 : a.fianca), 0);

  let pena = totalServicos;

  // Reduções (baseado nas observações do código penal)
  if (chkReuPrimario?.checked)   pena *= 0.70; // -30%
  if (chkAdvogado?.checked)      pena *= 0.70; // -30%
  if (chkCooperacao?.checked)    pena *= 0.90; // -10%
  if (chkDelacao?.checked)       pena *= 0.50; // -50%
  if (chkReuConfesso?.checked)   pena *= 0.85; // -15% (ajuste se quiser outro valor)

  pena = Math.round(pena);
  if (pena < 0) pena = 0;

  // Atualiza UI principal
  penaFinalSpan.textContent = pena;
  resultadoMultaSpan.textContent = formatarMoeda(totalMulta);
  resultadoFiancaSpan.textContent = formatarMoeda(totalFianca);

  // Define status
  let tipoStatus = "";
  let status = "";
  let detalhe = "";

  if (pena === 0 && totalFianca > 0) {
    tipoStatus = "liberdade";
    status = "LIBERDADE";
    detalhe = "Indivíduo liberado mediante pagamento da fiança.";
  } else if (pena <= 40) {
    tipoStatus = "pena_parcial";
    status = "PENA PARCIAL";
    detalhe = "Pena moderada. Possível acordo ou redução adicional conforme o RP.";
  } else {
    tipoStatus = "prisao";
    status = "PRISÃO";
    detalhe = "Indivíduo segue preso para cumprimento integral da pena.";
  }

  statusRPSpan.textContent = status;
  statusRPDetalhe.textContent = detalhe;

  const resultado = {
    tipo: tipoStatus,
    servicos: pena,
    multa: totalMulta,
    fianca: totalFianca
  };

  gerarResumoDiscord(resultado);
}

// ============================
// RESUMO PARA DISCORD
// ============================

function gerarResumoDiscord(resultadoFinal) {
  if (!resultadoFinal) return;

  const nome = (inputNome?.value || "").trim() || "Não informado";
  const cpf = (inputCPF?.value || "").trim() || "Não informado";
  const artigosLista = listaArtigos.map(a => a.codigo).join(", ") || "Nenhum";

  const servicos = resultadoFinal.servicos || 0;
  const multaTexto = formatarMoeda(resultadoFinal.multa || 0);
  const fiancaTexto = formatarMoeda(resultadoFinal.fianca || 0);

  const status = statusRPSpan.textContent || "—";
  const situacaoTexto = selectSituacao ? selectSituacao.value : "";

  let texto = `**${status.toUpperCase()}**\n`;

  if (situacaoTexto) {
    texto += `> **Situação:** ${situacaoTexto}\n\n`;
  }

  texto += "-----------------------------\n";
  texto += `**Nome:** ${nome}\n`;
  texto += `**CPF:** ${cpf}\n`;
  texto += `**Artigos:** ${artigosLista}\n`;
  texto += `**Pena:** ${servicos} meses\n`;
  texto += `**Multa:** ${multaTexto}\n`;
  texto += `**Fiança:** ${fiancaTexto}\n`;
  texto += "-----------------------------";

  if (resumoDiscordTextarea) {
    resumoDiscordTextarea.value = texto;
  }

  return texto;
}

// ============================
// EVENTOS
// ============================

if (btnAdicionar) {
  btnAdicionar.addEventListener("click", () => {
    const codInput = (inputCodigo?.value || "").trim();
    const codSelect = selectArtigo?.value || "";
    const codigo = codInput || codSelect;

    if (!codigo) {
      alert("Digite um código ou selecione um artigo.");
      return;
    }

    adicionarArtigo(codigo);
  });
}

// Enter no campo de código adiciona artigo
if (inputCodigo) {
  inputCodigo.addEventListener("keyup", (e) => {
    if (e.key === "Enter") {
      btnAdicionar.click();
    }
  });
}

if (btnCalcularFinal) {
  btnCalcularFinal.addEventListener("click", calcularPenaFinal);
}

if (btnCopiarDiscord && resumoDiscordTextarea) {
  btnCopiarDiscord.addEventListener("click", () => {
    const texto = resumoDiscordTextarea.value;
    if (!texto.trim()) {
      alert("Calcule a pena primeiro para gerar o texto.");
      return;
    }

    navigator.clipboard.writeText(texto).then(() => {
      const old = btnCopiarDiscord.textContent;
      btnCopiarDiscord.textContent = "Copiado!";
      setTimeout(() => (btnCopiarDiscord.textContent = old), 1500);
    });
  });
}

// Inicializa select
popularSelectArtigos();

</script>
